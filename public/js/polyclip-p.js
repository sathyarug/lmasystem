window.console||(window.console={log:function(){},error:function(){},debug:function(){}}); var polyClip=new function(){function n(a){G&&console.log(a)}function M(a,b){var e=new Image;jQuery(b).attr("data-polyclip-index",a);jQuery(e).bind("load",function(f){f=jQuery(b);f.attr("data-polyclip-transformorigin")||f.attr("data-polyclip-transformorigin",b.width/2+","+b.height/2);n("Cached "+e.src);C[e.src]=e;drawShape(a,b);var w;f=C;var t=0;for(w in f)f.hasOwnProperty(w)&&t++;w=t;u.length==w?g.runCallbacks():n("Cached "+u.length+" out of "+w+" images.")});e.src=b.src}function x(a,b,e,f,g){a=a.x(b.add(e)); a=a.add(f);g.push(a.e(1));g.push(a.e(2));return a}function N(a){var b=!1;jQuery.each(a.attributes,function(a,f){0==f.name.indexOf("data-")&&(b=!0)});return b}var g=this,u,y=[],C=[],H=[],D=[],I=navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?!0:!1;!I&&document.createElementNS&&document.createElementNS("http://www.w3.org/2000/svg","svg");var B,J,K,G=!1,E=!1;g.useSVGGlobally=!1;g.aniamtionNode=null;g.index=-1;g.isOldIE=window.G_vmlCanvasManager;g.polygonCache=[];g.init=function(){n("Initializing."); for(var a=document.getElementsByTagName("script"),b=null,e=0;e<a.length;e++){var f=a[e];f.src.match("polyclip(-p){0,1}.js")&&(b=f)}b&&N(b)||(b=document.body);if(B=b){J=B.getAttribute("data-polyclip-clippreference");K=B.getAttribute("data-polyclip-forcepointerevents");G=B.getAttribute("data-polyclip-showdebugmessages")||!1;E=!g.isOldIE&&!I&&"true"==K;if(a="SVG"==J&&E)a=document.createElement("x"),b=document.documentElement,e=window.getComputedStyle,"pointerEvents"in a.style?(a.style.pointerEvents= "auto",a.style.pointerEvents="x",b.appendChild(a),e=e&&"auto"===e(a,"").pointerEvents,b.removeChild(a),a=!!e):a=!1,a=!a;a&&(g.useSVGGlobally=!0)}g.$animationNode=jQuery('<div id="polyClip-tmp" />');document.body.appendChild(g.$animationNode.get(0));u=jQuery("img[data-polyclip]");n("Clipping "+u.length+" image(s).");0<u.length?u.each(M):g.runCallbacks()};g.clipImage=function(a,b,e,f,g){var t=a.jquery?a:jQuery(a),k=b;f=t.attr("data-polyclip-transformorigin");var c,h;a=a.jquery?a.get(0):a;f&&(f=f.split(",")); f&&2==f.length&&(c=parseFloat(f[0]),h=parseFloat(f[1]));!f||isNaN(c)||isNaN(h)?(f=a.offsetWidth/2,g=a.offsetHeight/2):(f=c,g=h);a.jquery&&a.get(0);if(e)if(window.$M){n("transform: "+e);"string"==typeof e&&(e=F.getTransformationMatrix(e));a=e;h=f;k=g;c=jQuery.trim(b);h=null==h?0:h;k=null==k?0:k;b=$V([-h,-k,0]);var k=$V([h,k,0]),m;if(0==c.indexOf("path:")){c=c.substring(5);h=c.replace(","," ").split(/\s+/);var d=[],q=$V([0,0,1]),l=null;for(c=0;c<h.length;){var p=h[c];isNaN(parseFloat(p))?d.push(p): (p=l,c--);var L=p.toUpperCase(),l=0;switch(L){case "M":case "L":case "T":l=1;break;case "S":case "Q":l=2;break;case "C":l=2}switch(L){case "H":m=$V([parseFloat(h[c+1]),q.e(2),1]);x(a,m,b,k,d);break;case "V":m=$V([q.e(1),parseFloat(h[c+1]),1]);x(a,m,b,k,d);break;case "M":case "L":case "T":case "S":case "Q":case "C":for(q=0;q<l;q++)m=$V([parseFloat(h[c+2*q+1]),parseFloat(h[c+2*q+2]),1]),x(a,m,b,k,d);break;case "A":d.push(h[c+1],h[c+2],h[c+3],h[c+4],h[c+5]),m=$V([parseFloat(h[c+6]),parseFloat(h[c+7]), 1]),x(a,m,b,k,d)}c+=1+2*l;l=p;q=m}k=void 0}else{h=[];d=c.split(",");for(c=0;c<d.length;c+=2)m=$V([parseInt(jQuery.trim(d[c])),parseInt(jQuery.trim(d[c+1])),1]),x(a,m,b,k,h),n(a.e(1,1));k=h.join(",")}n(e)}else n("Sylvester.js is needed for scaling clip. Transformation aborted.");t.attr("data-polyclip-transformcoords",k).attr("data-polyclip-transformorigin",f+","+g).each(drawShape);return t};g.transformClip=function(a,b,e,f){a=a.jquery?a:jQuery(a);g.clipImage(a,a.attr("data-polyclip"),b,e,f)};drawShape= function(a,b){var e=jQuery(b),f=jQuery.trim(e.attr("data-polyclip")),w=jQuery.trim(e.attr("data-polyclip-transformcoords")),t=e.attr("data-polyclip-transformorigin").split(",");parseFloat(t[0]);parseFloat(t[1]);var k=w||f,c,h,m,d;c=b.src;var q,l=b.id?b.id:"polyClip"+a,p=e,n,u,x=(g.useSVGGlobally||"SVG"==b.getAttribute("data-polyclip-clippreference")||"SVG"==b.nodeName.toUpperCase())&&E,v;q=[];if(0==k.indexOf("path:"))m=k.substr(5);else for(h=k.split(","),k=0;k<h.length;k+=2){var z=parseInt(jQuery.trim(h[k])), A=parseInt(jQuery.trim(h[k+1]));q.push(z+","+A+" ")}if(x||m)v='width="'+b.offsetWidth+'" height="'+b.offsetHeight+'"',v='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="'+l+'" class="polyClip-clipped" xmlns:xlink="http://www.w3.org/1999/xlink" '+v+'><defs><pattern id="polyClip-img-for-'+l+'" patternUnits="userSpaceOnUse" '+v+'><image xlink:href="'+c+'" x="0" y="0" '+v+"/></pattern></defs>",v=m?v+('<path id="polyClip-poly-for-'+l+'" d="'+m+'" style="fill:url(\'#polyClip-img-for-'+l+"');\" /></svg>"): v+('<polygon id="polyClip-poly-for-'+l+'" points="'+q.join()+'" style="fill:url(\'#polyClip-img-for-'+l+"');\" /></svg>");switch(b.nodeName.toUpperCase()){case "IMG":n=b.offsetWidth;u=b.offsetHeight;if(x)n=(new DOMParser).parseFromString(v,"application/xml"),importNode=b.ownerDocument.importNode(n.documentElement,!0),e.attr("id","").replaceWith(importNode),e=jQuery(importNode),e.attr("data-polyclip",f).attr("data-polyclip-transformcoords",w).attr("data-polyclip-transformorigin",t).attr("data-polyclip-transformoriginy", t),g.polygonCache[l]=jQuery("#polyClip-poly-for-"+l,e).get(0),n=b.offsetWidth,u=b.offsetHeight,p=e;else{var r=document.createElement("canvas"),p=jQuery(r);d=e.attr("data-polyclip-width");r.width=d?parseInt(d):n;d=e.attr("data-polyclip-height");r.height=d?parseInt(d):u;r.id=l;p.attr("data-polyclip",f).attr("data-polyclip-transformcoords",w).attr("data-polyclip-transformorigin",t).attr("data-src",c).addClass("polyClip-clipped");e.replaceWith(r);g.isOldIE&&G_vmlCanvasManager.initElement(r);d=r.getContext("2d"); H[l]=d;jQuery(window).trigger("resize");f=p.css("pointer-events");g.polygonCache[l]={ctx:d,imageData:d.getImageData?d.getImageData(0,0,r.width,r.height).data:null,pointerEventCSS:f?f.toLowerCase():null}}break;case "SVG":m?g.polygonCache[l].setAttribute("d",m):g.polygonCache[l].setAttribute("points",q.join());break;case "CANVAS":r=b,c=e.attr("data-src"),d=H[l]}if(!x){y[r.id]=[];d.save();d.clearRect(0,0,r.width,r.height);if(m)d.drawSvg(v,0,0,n,u);else{d.beginPath();for(k=0;k<h.length;k+=2)z=parseInt(jQuery.trim(h[k])), A=parseInt(jQuery.trim(h[k+1])),y[r.id].push({x:z,y:A}),0==k?d.moveTo(z,A):d.lineTo(z,A);d.closePath()}g.isOldIE?(d.fillStyle="",d.fill(),h=jQuery("fill",r).get(0),m=jQuery("shape",r).get(0),h.color="none",m.fillcolor="none",h.src=c,h.type="tile",h.alignShape=!1):(c=d.createPattern(C[c],"repeat"),d.fillStyle=c,d.fill());d.restore();f=p.css("pointer-events");g.polygonCache[l]={ctx:d,imageData:d.getImageData?d.getImageData(0,0,r.width,r.height).data:null,pointerEventCSS:f?f.toLowerCase():null}}return p}; g.findObject=function(a){var b=a.currentTarget;if(jQuery(b).hasClass("cropParent"))return jQuery(b);for(var e in y)if(y.hasOwnProperty(e)&&(b=jQuery("#"+e),g.isInPolygon(b,a.pageX,a.pageY,!0)))return b};g.isInPolygon=function(a,b,e,f){var g=a.get(0),g=y[g.id],n=g.length,k,c,h,m,d,q,l=!1,p={left:0,top:0};f&&(p=a.offset());if(3>n)return!1;k=g[n-1].x+p.left;c=g[n-1].y+p.top;for(q=0;q<n;q++)a=g[q].x+p.left,f=g[q].y+p.top,a>k?(h=k,d=a,m=c,c=f):(h=a,d=k,m=f),a<b==b<=k&&(e-m)*(d-h)<(c-m)*(b-h)&&(l=!l),k= a,c=f;return l};g.addCallback=function(a){D.push(a)};g.runCallbacks=function(){n("Cached all images. Running callbacks...");for(var a=0;a<D.length;a++)D[a]()};if(window.$M)var F=new function(){function a(c){var a=parseFloat(c),b=c.match(e);"0"==jQuery.trim(c)&&(a=0,b="rad");if(1!=b.length||0==a)return 0;b=b[0];switch(b){case "deg":c=a*Math.PI/180;break;case "rad":c=a;break;default:throw"Not an angle: "+c;}return c}var b=this,e=/[a-z]+$/,f=/[a-zA-Z]+\([^\)]*\)\s*/g,g=/\(/g,t=/\)/g,k=/,/g;b.identity= $M([[1,0,0],[0,1,0],[0,0,1]]);b.prettyPrint=function(c){return StringHelpers.sprintf("| %s %s %s | - | %s %s %s | - |%s %s %s|",c.e(1,1),c.e(1,2),c.e(1,3),c.e(2,1),c.e(2,2),c.e(2,3),c.e(3,1),c.e(3,2),c.e(3,3))};b.rotate=function(c){c=a(c);return Matrix.RotationZ(c)};b.scale=function(c,a){c=parseFloat(c);a=a?parseFloat(a):c;return $M([[c,0,0],[0,a,0],[0,0,1]])};b.scaleX=function(c){return b.scale(c,1)};b.scaleY=function(c){return b.scale(1,c)};b.skew=function(c,b){var e=a(c),d;d=null!=b?a(b):e;return null!= e&&null!=d?$M([[1,Math.tan(e),0],[Math.tan(d),1,0],[0,0,1]]):null};b.skewX=function(c){return b.skew(c,"0")};b.skewY=function(c){return b.skew("0",c)};b.translate=function(c,a){var b=parseInt(c),d=parseInt(a);return $M([[1,0,b],[0,1,d],[0,0,1]])};b.translateX=function(c){return b.translate(c,0)};b.translateY=function(c){return b.translate(0,c)};b.matrix=function(c,a,b,d,e,f){return $M([[c,b,parseInt(e)],[a,d,parseInt(f)],[0,0,1]])};b.getTransformationMatrix=function(c,a){n("transformString is "+c); var b=c.match(f);if(a){var d=b.join(" ").replace(/\s*/g," "),e=c.replace(/\s*/g," ");if(d!=e)throw"An invalid transform was given: "+c;}e=F.identity;n("num of transforms "+b.length);for(var l=0;l<b.length;l++){d=b[l];d=d.replace(g,'("').replace(k,'", "').replace(t,'")');try{n("looking up : "+d);var p=eval("MatrixGenerator."+d),e=e.x(p)}catch(u){if(a){b=d.split("(")[0];p=d.replace(/\"/g,"");if(void 0==F[b])throw"Error: invalid tranform function: "+p;throw"Error: Invalid or missing parameters in function call: "+ p;}}}return e}}};document.write('<style type="text/css">img[data-polyclip], img.polyClip { visibility: hidden; } </style>');polyClip.isOldIE?jQuery(window).bind("load",polyClip.init):jQuery(document).ready(polyClip.init);